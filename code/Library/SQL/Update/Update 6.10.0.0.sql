/* UPDATE 6.10.0.0*/

SET SEARCH_PATH = "COMMON";

UPDATE "Variable" SET "VALUE" = '6.10.0.0' WHERE "NAME" = 'INVOICE_DB_VERSION';

INSERT INTO "COMMON"."SecureItem" ("NAME", "TIPO", "DESCRIPTOR") VALUES ('Transaction', '309', 'TRANSACTION');

INSERT INTO "COMMON"."ItemMap" ("OID_ITEM", "PRIVILEGE", "OID_ASSOCIATE_ITEM", "ASSOCIATE_PRIVILEGE")  
	SELECT SI."OID", '1', ASI."OID", '1' 
	FROM "COMMON"."SecureItem" AS SI
	INNER JOIN "COMMON"."SecureItem" AS ASI ON SI."DESCRIPTOR" = 'SUSCRIPTION' AND ASI."DESCRIPTOR" = 'TRANSACTION';
	
INSERT INTO "COMMON"."ItemMap" ("OID_ITEM", "PRIVILEGE", "OID_ASSOCIATE_ITEM", "ASSOCIATE_PRIVILEGE")  
	SELECT SI."OID", '2', ASI."OID", '2' 
	FROM "COMMON"."SecureItem" AS SI
	INNER JOIN "COMMON"."SecureItem" AS ASI ON SI."DESCRIPTOR" = 'SUSCRIPTION' AND ASI."DESCRIPTOR" = 'TRANSACTION';
	
INSERT INTO "COMMON"."ItemMap" ("OID_ITEM", "PRIVILEGE", "OID_ASSOCIATE_ITEM", "ASSOCIATE_PRIVILEGE")  
	SELECT SI."OID", '3', ASI."OID", '3' 
	FROM "COMMON"."SecureItem" AS SI
	INNER JOIN "COMMON"."SecureItem" AS ASI ON SI."DESCRIPTOR" = 'SUSCRIPTION' AND ASI."DESCRIPTOR" = 'TRANSACTION';
	
INSERT INTO "COMMON"."ItemMap" ("OID_ITEM", "PRIVILEGE", "OID_ASSOCIATE_ITEM", "ASSOCIATE_PRIVILEGE")  
	SELECT SI."OID", '4', ASI."OID", '4' 
	FROM "COMMON"."SecureItem" AS SI
	INNER JOIN "COMMON"."SecureItem" AS ASI ON SI."DESCRIPTOR" = 'SUSCRIPTION' AND ASI."DESCRIPTOR" = 'TRANSACTION';
	
SET SEARCH_PATH = "0001";

ALTER TABLE "Cliente" ADD COLUMN "COUNTRY" character varying(255);
ALTER TABLE "Cliente" ADD COLUMN "BIRTH_DATE" timestamp without time zone;

DROP TABLE IF EXISTS "IVTransaction" CASCADE;
CREATE TABLE "IVTransaction" 
( 
	"OID" bigserial NOT NULL,
	"OID_ENTITY" int8 NOT NULL,
	"ENTITY_TYPE" int8 NOT NULL,
	"SERIAL" int8 DEFAULT 0 NOT NULL,
	"CODE" character varying(255),
	"TYPE" int8 DEFAULT 1,
	"STATUS" int8 DEFAULT 1,
	"CREATED" timestamp without time zone,
	"RESOLVED" timestamp without time zone,	
	"TRANSACTIONID" character varying(255),
	"AUTH_CODE" character varying(255),
	"PAN_MASK" character varying(255),
	"AMOUNT" numeric(10,2),
	"CURRENCY" int8 NOT NULL DEFAULT 1,
	"GATEWAY" int8 NOT NULL DEFAULT 1,
	"DESCRIPTION" text,
    CONSTRAINT "IVTransaction_PK" PRIMARY KEY ("OID")
)WITHOUT OIDS;

ALTER TABLE "IVTransaction" OWNER TO moladmin;
GRANT ALL ON TABLE "IVTransaction" TO GROUP "MOLEQULE_ADMINISTRATOR";
