/* UPDATE 5.8.0.0*/

SET SEARCH_PATH = "COMMON";

UPDATE "Variable" SET "VALUE" = '5.8.0.0' WHERE "NAME" = 'INVOICE_DB_VERSION';

INSERT INTO "UserSetting" ("OID_USER", "NAME", "VALUE") (SELECT U."OID", 'DEFAULT_ALMACEN', '1' FROM "User" AS U);

SET SEARCH_PATH = "0001";

ALTER TABLE "ConceptoAlbaran" ADD COLUMN "OID_ALMACEN" bigint DEFAULT 0;

UPDATE "ConceptoAlbaran" SET "OID_ALMACEN" = 1;

ALTER TABLE "ConceptoFactura" ADD COLUMN "OID_ALMACEN" bigint DEFAULT 0; 

ALTER TABLE "Factura" ADD COLUMN "OID_USUARIO" bigint DEFAULT 0;

ALTER TABLE "Albaran" ADD COLUMN "OID_USUARIO" bigint DEFAULT 0;
ALTER TABLE "Albaran" ADD COLUMN "OID_ALMACEN" bigint DEFAULT 0;
ALTER TABLE "Albaran" ADD COLUMN "OID_EXPEDIENTE" bigint DEFAULT 0;
ALTER TABLE "Albaran" ALTER COLUMN "FECHA" TYPE timestamp without time zone;

ALTER TABLE "Pedido" ADD COLUMN "OID_ALMACEN" bigint DEFAULT 0;
ALTER TABLE "Pedido" ADD COLUMN "OID_EXPEDIENTE" bigint DEFAULT 0;

ALTER TABLE "LineaPedido" ADD COLUMN "OID_ALMACEN" bigint DEFAULT 0;
ALTER TABLE "LineaPedido" ADD COLUMN "OID_IMPUESTO" bigint DEFAULT 0;

ALTER TABLE "Producto_Cliente" ADD COLUMN "P_DESCUENTO" numeric(10,2) DEFAULT 0;
ALTER TABLE "Producto_Cliente" ADD COLUMN "TIPO_DESCUENTO" bigint DEFAULT 1;

UPDATE "Producto_Cliente" SET "TIPO_DESCUENTO" = 1;

ALTER TABLE "Cliente" ADD COLUMN "P_DESCUENTO_PTO_PAGO" numeric(10,2) DEFAULT 0;
ALTER TABLE "Cliente" RENAME COLUMN "CODIGO" TO "VAT_NUMBER";
ALTER TABLE "Cliente" ADD COLUMN "CODIGO" varchar(255);
ALTER TABLE "Cliente" ADD COLUMN "PRIORIDAD_PRECIO" bigint DEFAULT 3;

UPDATE "Cliente" set "CODIGO" = to_char("NUMERO_CLIENTE",'00000');

ALTER TABLE "Cliente" DROP COLUMN "NUMERO_CLIENTE";

INSERT INTO "Setting" ("NAME", "VALUE") VALUES ('DEFAULT_TIPO_FACTURACION', '1');
INSERT INTO "Setting" ("NAME", "VALUE") VALUES ('DEFAULT_TIPO_DESCUENTO', '2');
INSERT INTO "Setting" ("NAME", "VALUE") VALUES ('CONTROL_STOCK_NEGATIVO', 'TRUE');
INSERT INTO "Setting" ("NAME", "VALUE") VALUES ('N_DIGITOS_N_FACTURA', '5');
INSERT INTO "Setting" ("NAME", "VALUE") VALUES ('N_DECIMALES_PRECIOS', '5');

--ALTER TABLE "LineaPedido" ADD COLUMN "OID_PRODUCTO" bigint DEFAULT 0;

