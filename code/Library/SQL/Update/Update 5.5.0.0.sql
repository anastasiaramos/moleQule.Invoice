/* UPDATE 5.5.0.0*/

SET SEARCH_PATH = "COMMON";

UPDATE "Variable" SET "VALUE" = '5.5.0.0' WHERE "NAME" = 'INVOICE_DB_VERSION';

SET SEARCH_PATH = "0001";

DROP TABLE  IF EXISTS "LineaPedido" CASCADE;
CREATE TABLE "LineaPedido" 
( 
	"OID" bigserial  NOT NULL,
	"OID_PEDIDO" int8 NOT NULL,
	"OID_PRODUCTO" int8 NOT NULL,
	"ESTADO" int8,
	"CONCEPTO" varchar(255),
	"CANTIDAD" numeric(10,2) NOT NULL DEFAULT 0,
	"CANTIDAD_BULTOS" numeric(10,4),
	"PRECIO" numeric(10,5),
	"TOTAL" numeric(10,2),
	"OBSERVACIONES" text,
	CONSTRAINT "PK_LineaPedido" PRIMARY KEY ("OID")
) WITHOUT OIDS;

ALTER TABLE "LineaPedido" OWNER TO moladmin;
GRANT ALL ON TABLE "LineaPedido" TO GROUP "MOLEQULE_ADMINISTRATOR";

DROP TABLE  IF EXISTS "Pedido" CASCADE;
CREATE TABLE "Pedido" 
( 
	"OID" bigserial  NOT NULL,
	"OID_USUARIO" bigint DEFAULT 0,
	"OID_CLIENTE" bigint DEFAULT 0,
	"OID_PRODUCTO" bigint DEFAULT 0,
	"SERIAL" int8 NOT NULL,
	"CODIGO" varchar(255) NOT NULL,
	"FECHA" timestamp,
	"TOTAL" numeric(10,2),
	"ESTADO" int8,
	"OBSERVACIONES" text,
	CONSTRAINT "PK_Pedido" PRIMARY KEY ("OID")
) WITHOUT OIDS;

ALTER TABLE "Pedido" OWNER TO moladmin;
GRANT ALL ON TABLE "Pedido" TO GROUP "MOLEQULE_ADMINISTRATOR";

ALTER TABLE "LineaPedido" ADD CONSTRAINT "FK_LineaPedido_Pedido" FOREIGN KEY ("OID_PEDIDO") REFERENCES "Pedido" ("OID") ON UPDATE CASCADE ON DELETE RESTRICT;
ALTER TABLE "Pedido" ADD CONSTRAINT "FK_Pedido_Cliente" FOREIGN KEY ("OID_CLIENTE") REFERENCES "Cliente" ("OID") ON UPDATE CASCADE ON DELETE RESTRICT;
